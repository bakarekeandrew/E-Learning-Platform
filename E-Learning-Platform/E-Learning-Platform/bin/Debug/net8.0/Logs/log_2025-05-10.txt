[INFO] [2025-05-10 11:48:27] [OtpService] Initialized with default connection string
[INFO] [2025-05-10 11:48:50] [OtpService] Initialized with default connection string
[INFO] [2025-05-10 11:58:17] [OtpService] Initialized with default connection string
[INFO] [2025-05-10 11:58:35] [OtpService] Initialized with default connection string
[INFO] [2025-05-10 12:03:28] [OtpService] Initialized with default connection string
[INFO] [2025-05-10 12:03:39] [OtpService] Initialized with default connection string
[INFO] [2025-05-10 12:08:43] [OtpService] Initialized with default connection string
[INFO] [2025-05-10 12:08:50] [OtpService] Initialized with default connection string
[INFO] [2025-05-10 12:33:28] [OtpService] Initialized with default connection string
[INFO] [2025-05-10 12:33:42] [OtpService] Initialized with default connection string
[INFO] [2025-05-10 14:02:01] [OtpService] Initialized with default connection string
[INFO] [2025-05-10 14:02:19] [OtpService] Initialized with default connection string
[INFO] [2025-05-10 14:20:02] [OtpService] Initialized with default connection string
[INFO] [2025-05-10 14:20:28] [OtpService] Initialized with default connection string
[INFO] [2025-05-10 14:30:07] [OtpService] Initialized with default connection string
[INFO] [2025-05-10 14:30:25] [OtpService] Initialized with default connection string
[INFO] [2025-05-10 14:30:38] [OtpService] Initialized with default connection string
[INFO] [2025-05-10 14:46:15] [OtpService] Initialized with default connection string
[INFO] [2025-05-10 14:46:24] [OtpService] Initialized with default connection string
[INFO] [2025-05-10 15:03:57] [OtpService] Initialized with default connection string
[INFO] [2025-05-10 15:04:08] [OtpService] Initialized with default connection string
[INFO] [2025-05-10 15:12:52] [OtpService] Initialized with default connection string
[INFO] [2025-05-10 15:13:47] [OtpService] Initialized with default connection string
[INFO] [2025-05-10 15:21:11] [OtpService] Initialized with default connection string
[INFO] [2025-05-10 15:21:29] [OtpService] Initialized with default connection string
[INFO] [2025-05-10 15:32:06] [OtpService] Initialized with default connection string
[INFO] [2025-05-10 15:32:29] [OtpService] Initialized with default connection string
[INFO] [2025-05-10 15:40:38] [OtpService] Initialized with default connection string
[INFO] [2025-05-10 15:40:47] [OtpService] Initialized with default connection string
[INFO] [2025-05-10 15:45:01] [OtpService] Initialized with default connection string
[INFO] [2025-05-10 15:45:10] [OtpService] Initialized with default connection string
[INFO] [2025-05-10 15:49:35] [OtpService] Initialized with default connection string
[INFO] [2025-05-10 15:50:14] [OtpService] Initialized with default connection string
[INFO] [2025-05-10 16:11:46] [OtpService] Initialized with default connection string
[INFO] [2025-05-10 16:11:57] [OtpService] Initialized with default connection string
[INFO] [2025-05-10 16:36:48] [OtpService] Initialized with default connection string
[INFO] [2025-05-10 16:36:56] [OtpService] Initialized with default connection string
[INFO] [2025-05-10 16:39:28] [OtpService] Initialized with default connection string
[INFO] [2025-05-10 16:39:45] [OtpService] Initialized with default connection string
[INFO] [2025-05-10 16:52:06] [OtpService] Initialized with default connection string
[INFO] [2025-05-10 16:52:16] [OtpService] Initialized with default connection string
[INFO] [2025-05-10 16:58:37] [OtpService] Initialized with default connection string
[INFO] [2025-05-10 16:58:53] [OtpService] Initialized with default connection string
[INFO] [2025-05-10 17:04:43] [OtpService] Initialized with default connection string
[INFO] [2025-05-10 17:04:51] [OtpService] Initialized with default connection string
[INFO] [2025-05-10 17:25:09] [OtpService] Initialized with default connection string
[INFO] [2025-05-10 17:25:17] [OtpService] Initialized with default connection string
[INFO] [2025-05-10 17:25:27] [OtpService] Initialized with default connection string
[INFO] [2025-05-10 17:32:53] [OtpService] Initialized with default connection string
[INFO] [2025-05-10 17:33:13] [OtpService] Initialized with default connection string
[INFO] [2025-05-10 18:20:19] [OtpService] Initialized with default connection string
[INFO] [2025-05-10 18:20:21] [SignupPageModel] Initializing SignupPageModel
[INFO] [2025-05-10 18:20:21] [OtpService] Initialized with provided connection string
[INFO] [2025-05-10 18:20:21] [SignupPageModel] Loading signup page
[INFO] [2025-05-10 18:20:21] [SignupPageModel] Loading roles from database
[INFO] [2025-05-10 18:20:21] [SignupPageModel] Loaded 3 roles successfully
[INFO] [2025-05-10 18:20:21] [SignupPageModel] Roles loaded successfully
[INFO] [2025-05-10 18:21:02] [SignupPageModel] Initializing SignupPageModel
[INFO] [2025-05-10 18:21:02] [OtpService] Initialized with provided connection string
[INFO] [2025-05-10 18:21:02] [SignupPageModel] Signup form submitted
[INFO] [2025-05-10 18:21:02] [SignupPageModel] Model validation failed
[INFO] [2025-05-10 18:21:02] [SignupPageModel] Loading roles from database
[INFO] [2025-05-10 18:21:02] [SignupPageModel] Loaded 3 roles successfully
[INFO] [2025-05-10 18:29:12] [OtpService] Initialized with default connection string
[INFO] [2025-05-10 18:29:14] [SignupPageModel] Initializing SignupPageModel
[INFO] [2025-05-10 18:29:14] [OtpService] Initialized with provided connection string
[INFO] [2025-05-10 18:29:14] [SignupPageModel] Loading signup page
[INFO] [2025-05-10 18:29:14] [SignupPageModel] Loading roles from database
[INFO] [2025-05-10 18:29:15] [SignupPageModel] Loaded 3 roles successfully
[INFO] [2025-05-10 18:29:15] [SignupPageModel] Roles loaded successfully
[INFO] [2025-05-10 18:30:02] [SignupPageModel] Initializing SignupPageModel
[INFO] [2025-05-10 18:30:02] [OtpService] Initialized with provided connection string
[INFO] [2025-05-10 18:30:02] [SignupPageModel] Signup form submitted
[INFO] [2025-05-10 18:30:02] [SignupPageModel] Checking if email exists: luckybrownandrew@gmail.com
[INFO] [2025-05-10 18:30:02] [SignupPageModel] Checking if email exists: luckybrownandrew@gmail.com
[INFO] [2025-05-10 18:30:02] [SignupPageModel] Email exists check result: False
[INFO] [2025-05-10 18:30:02] [OtpService] Generated new OTP code: 117698
[INFO] [2025-05-10 18:30:02] [SignupPageModel] Generated OTP: 117698
[INFO] [2025-05-10 18:30:02] [SignupPageModel] Password hashed successfully
[INFO] [2025-05-10 18:30:02] [SignupPageModel] Database connection opened
[INFO] [2025-05-10 18:30:02] [SignupPageModel] Temporary user created with ID: 1
[INFO] [2025-05-10 18:30:02] [SignupPageModel] Sending OTP email to: luckybrownandrew@gmail.com
[INFO] [2025-05-10 18:30:02] [EmailService] Attempting to send OTP email to luckybrownandrew@gmail.com
[INFO] [2025-05-10 18:30:07] [EmailService] Successfully sent OTP email to luckybrownandrew@gmail.com
[INFO] [2025-05-10 18:30:07] [SignupPageModel] OTP email sent successfully
[INFO] [2025-05-10 18:30:07] [SignupPageModel] Loading roles from database
[INFO] [2025-05-10 18:30:07] [SignupPageModel] Loaded 3 roles successfully
[INFO] [2025-05-10 18:31:27] [SignupPageModel] Initializing SignupPageModel
[INFO] [2025-05-10 18:31:27] [OtpService] Initialized with provided connection string
[INFO] [2025-05-10 18:31:27] [SignupPageModel] OTP verification submitted
[INFO] [2025-05-10 18:31:27] [SignupPageModel] Verifying OTP for temp user: 1
[INFO] [2025-05-10 18:31:27] [SignupPageModel] Database connection opened for verification
[INFO] [2025-05-10 18:31:27] [SignupPageModel] User successfully moved from temp to permanent table: 1
[INFO] [2025-05-10 18:31:27] [SignupPageModel] Signup process completed successfully
[INFO] [2025-05-10 18:31:27] [OtpService] Initialized with default connection string
[INFO] [2025-05-10 18:31:45] [OtpService] Initialized with default connection string
[INFO] [2025-05-10 19:41:52] [OtpService] Initialized with default connection string
[INFO] [2025-05-10 19:42:00] [ForgotPasswordModel] Initializing ForgotPasswordModel
[INFO] [2025-05-10 19:42:00] [OtpService] Initialized with provided connection string
[INFO] [2025-05-10 19:42:00] [ForgotPasswordModel] Loading forgot password page
[INFO] [2025-05-10 19:42:12] [ForgotPasswordModel] Initializing ForgotPasswordModel
[INFO] [2025-05-10 19:42:12] [OtpService] Initialized with provided connection string
[INFO] [2025-05-10 19:42:12] [ForgotPasswordModel] Password reset requested for email: luckybrownandrew@gmail.com
[INFO] [2025-05-10 19:42:12] [ForgotPasswordModel] Invalid model state for email request
[INFO] [2025-05-10 19:42:18] [ForgotPasswordModel] Initializing ForgotPasswordModel
[INFO] [2025-05-10 19:42:18] [OtpService] Initialized with provided connection string
[INFO] [2025-05-10 19:42:18] [ForgotPasswordModel] Password reset requested for email: luckybrownandrew@gmail.com
[INFO] [2025-05-10 19:42:18] [ForgotPasswordModel] Invalid model state for email request
[INFO] [2025-05-10 19:42:22] [ForgotPasswordModel] Initializing ForgotPasswordModel
[INFO] [2025-05-10 19:42:22] [OtpService] Initialized with provided connection string
[INFO] [2025-05-10 19:42:22] [ForgotPasswordModel] Password reset requested for email: luckybrownandrew@gmail.com
[INFO] [2025-05-10 19:42:22] [ForgotPasswordModel] Invalid model state for email request
[INFO] [2025-05-10 19:42:23] [ForgotPasswordModel] Initializing ForgotPasswordModel
[INFO] [2025-05-10 19:42:23] [OtpService] Initialized with provided connection string
[INFO] [2025-05-10 19:42:23] [ForgotPasswordModel] Password reset requested for email: luckybrownandrew@gmail.com
[INFO] [2025-05-10 19:42:23] [ForgotPasswordModel] Invalid model state for email request
[INFO] [2025-05-10 19:42:24] [ForgotPasswordModel] Initializing ForgotPasswordModel
[INFO] [2025-05-10 19:42:24] [OtpService] Initialized with provided connection string
[INFO] [2025-05-10 19:42:24] [ForgotPasswordModel] Password reset requested for email: luckybrownandrew@gmail.com
[INFO] [2025-05-10 19:42:24] [ForgotPasswordModel] Invalid model state for email request
[INFO] [2025-05-10 19:42:32] [ForgotPasswordModel] Initializing ForgotPasswordModel
[INFO] [2025-05-10 19:42:32] [OtpService] Initialized with provided connection string
[INFO] [2025-05-10 19:42:32] [ForgotPasswordModel] Password reset requested for email: luckybrownandrew@gmail.com
[INFO] [2025-05-10 19:42:32] [ForgotPasswordModel] Invalid model state for email request
[INFO] [2025-05-10 19:49:19] [ForgotPasswordModel] Initializing ForgotPasswordModel
[INFO] [2025-05-10 19:49:19] [OtpService] Initialized with provided connection string
[INFO] [2025-05-10 19:49:19] [ForgotPasswordModel] Password reset requested for email: luckybrownandrew@gmail.com
[INFO] [2025-05-10 19:49:19] [ForgotPasswordModel] Invalid model state for email request
[INFO] [2025-05-10 19:51:12] [OtpService] Initialized with default connection string
[INFO] [2025-05-10 19:51:18] [ForgotPasswordModel] Initializing ForgotPasswordModel
[INFO] [2025-05-10 19:51:18] [OtpService] Initialized with provided connection string
[INFO] [2025-05-10 19:51:18] [ForgotPasswordModel] Loading forgot password page
[INFO] [2025-05-10 19:51:26] [ForgotPasswordModel] Initializing ForgotPasswordModel
[INFO] [2025-05-10 19:51:26] [OtpService] Initialized with provided connection string
[INFO] [2025-05-10 19:51:26] [ForgotPasswordModel] Password reset requested for email: luckybrownandrew@gmail.com
[INFO] [2025-05-10 19:51:26] [ForgotPasswordModel] Invalid model state for email request
[INFO] [2025-05-10 19:51:32] [ForgotPasswordModel] Initializing ForgotPasswordModel
[INFO] [2025-05-10 19:51:32] [OtpService] Initialized with provided connection string
[INFO] [2025-05-10 19:51:32] [ForgotPasswordModel] Password reset requested for email: luckybrownandrew@gmail.com
[INFO] [2025-05-10 19:51:32] [ForgotPasswordModel] Invalid model state for email request
[INFO] [2025-05-10 19:53:27] [ForgotPasswordModel] Initializing ForgotPasswordModel
[INFO] [2025-05-10 19:53:27] [OtpService] Initialized with provided connection string
[INFO] [2025-05-10 19:53:27] [ForgotPasswordModel] Password reset requested for email: luckybrownandrew@gmail.com
[INFO] [2025-05-10 19:53:27] [ForgotPasswordModel] Invalid model state for email request
[INFO] [2025-05-10 19:56:01] [OtpService] Initialized with default connection string
[INFO] [2025-05-10 19:56:05] [ForgotPasswordModel] Initializing ForgotPasswordModel
[INFO] [2025-05-10 19:56:05] [OtpService] Initialized with provided connection string
[INFO] [2025-05-10 19:56:05] [ForgotPasswordModel] Loading forgot password page
[INFO] [2025-05-10 19:56:14] [ForgotPasswordModel] Initializing ForgotPasswordModel
[INFO] [2025-05-10 19:56:14] [OtpService] Initialized with provided connection string
[INFO] [2025-05-10 19:56:14] [ForgotPasswordModel] Password reset requested for email: luckybrownandrew@gmail.com
[INFO] [2025-05-10 19:56:14] [ForgotPasswordModel] Invalid model state for email request
[INFO] [2025-05-10 19:56:20] [OtpService] Initialized with default connection string
[INFO] [2025-05-10 19:56:23] [ForgotPasswordModel] Initializing ForgotPasswordModel
[INFO] [2025-05-10 19:56:23] [OtpService] Initialized with provided connection string
[INFO] [2025-05-10 19:56:23] [ForgotPasswordModel] Loading forgot password page
[INFO] [2025-05-10 19:56:29] [ForgotPasswordModel] Initializing ForgotPasswordModel
[INFO] [2025-05-10 19:56:29] [OtpService] Initialized with provided connection string
[INFO] [2025-05-10 19:56:29] [ForgotPasswordModel] Password reset requested for email: luckybrownandrew@gmail.com
[INFO] [2025-05-10 19:56:29] [ForgotPasswordModel] Invalid model state for email request
[INFO] [2025-05-10 20:20:58] [OtpService] Initialized with default connection string
[INFO] [2025-05-10 20:21:00] [ForgotPasswordModel] Initializing ForgotPasswordModel
[INFO] [2025-05-10 20:21:00] [OtpService] Initialized with provided connection string
[INFO] [2025-05-10 20:21:00] [ForgotPasswordModel] Loading forgot password page
[INFO] [2025-05-10 20:21:05] [ForgotPasswordModel] Initializing ForgotPasswordModel
[INFO] [2025-05-10 20:21:05] [OtpService] Initialized with provided connection string
[INFO] [2025-05-10 20:21:05] [ForgotPasswordModel] Password reset requested for email: luckybrownandrew@gmail.com
[INFO] [2025-05-10 20:21:05] [ForgotPasswordModel] Invalid model state for email request
[INFO] [2025-05-10 20:26:41] [OtpService] Initialized with default connection string
[INFO] [2025-05-10 20:26:46] [ForgotPasswordModel] Initializing ForgotPasswordModel
[INFO] [2025-05-10 20:26:46] [OtpService] Initialized with provided connection string
[INFO] [2025-05-10 20:26:46] [ForgotPasswordModel] Loading forgot password page
[INFO] [2025-05-10 20:26:50] [ForgotPasswordModel] Initializing ForgotPasswordModel
[INFO] [2025-05-10 20:26:50] [OtpService] Initialized with provided connection string
[INFO] [2025-05-10 20:31:51] [OtpService] Initialized with default connection string
[INFO] [2025-05-10 20:31:57] [ForgotPasswordModel] Initializing ForgotPasswordModel
[INFO] [2025-05-10 20:31:57] [OtpService] Initialized with provided connection string
[INFO] [2025-05-10 20:31:57] [ForgotPasswordModel] Loading forgot password page
[INFO] [2025-05-10 20:33:30] [OtpService] Initialized with default connection string
[INFO] [2025-05-10 20:33:32] [ForgotPasswordModel] Initializing ForgotPasswordModel
[INFO] [2025-05-10 20:33:32] [OtpService] Initialized with provided connection string
[INFO] [2025-05-10 20:33:32] [ForgotPasswordModel] Loading forgot password page
[INFO] [2025-05-10 20:33:36] [ForgotPasswordModel] Initializing ForgotPasswordModel
[INFO] [2025-05-10 20:33:36] [OtpService] Initialized with provided connection string
[INFO] [2025-05-10 20:33:40] [ForgotPasswordModel] Initializing ForgotPasswordModel
[INFO] [2025-05-10 20:33:40] [OtpService] Initialized with provided connection string
[INFO] [2025-05-10 20:39:49] [OtpService] Initialized with default connection string
[INFO] [2025-05-10 20:39:52] [ForgotPasswordModel] Initializing ForgotPasswordModel
[INFO] [2025-05-10 20:39:52] [OtpService] Initialized with provided connection string
[INFO] [2025-05-10 20:39:52] [ForgotPasswordModel] Loading forgot password page
[INFO] [2025-05-10 20:39:56] [ForgotPasswordModel] Initializing ForgotPasswordModel
[INFO] [2025-05-10 20:39:56] [OtpService] Initialized with provided connection string
[INFO] [2025-05-10 20:39:56] [OnPostRequestReset] Method started
[INFO] [2025-05-10 20:39:56] [OnPostRequestReset] Checking email existence: luckybrownandrew@gmail.com
[INFO] [2025-05-10 20:39:56] [ForgotPasswordModel] Checking if email exists: luckybrownandrew@gmail.com
[INFO] [2025-05-10 20:39:56] [ForgotPasswordModel] Email exists check result: True
[INFO] [2025-05-10 20:39:56] [OnPostRequestReset] Email found, getting user ID
[INFO] [2025-05-10 20:39:56] [ForgotPasswordModel] Getting user ID for email: luckybrownandrew@gmail.com
[INFO] [2025-05-10 20:39:56] [ForgotPasswordModel] Found user ID: 28
[INFO] [2025-05-10 20:39:56] [OnPostRequestReset] User ID found: 28
[INFO] [2025-05-10 20:39:56] [OtpService] Generated new OTP code: 185178
[INFO] [2025-05-10 20:39:56] [OnPostRequestReset] Generated OTP: 185178
[INFO] [2025-05-10 20:39:56] [OtpService] Saving OTP for user ID: 28, Code: 185178
[INFO] [2025-05-10 20:39:56] [OtpService] Opening database connection
[INFO] [2025-05-10 20:39:56] [OtpService] Database connection opened successfully
[INFO] [2025-05-10 20:39:56] [OtpService] Transaction started
[INFO] [2025-05-10 20:39:57] [OtpService] Invalidated 0 existing OTPs for user ID: 28
[INFO] [2025-05-10 20:39:57] [OtpService] Executing SQL: INSERT INTO USER_OTPS (USER_ID, OTP_CODE, EXPIRATION_TIME, IS_VALID, CREATED_AT) 
                                          VALUES (@UserId, @OtpCode, DATEADD(MINUTE, 10, GETDATE()), 1, GETDATE()) with UserId=28, OtpCode=185178
[INFO] [2025-05-10 20:39:57] [OtpService] Inserted 1 new OTP records
[INFO] [2025-05-10 20:39:57] [OtpService] Committing transaction
[INFO] [2025-05-10 20:39:57] [OtpService] Transaction committed successfully
[INFO] [2025-05-10 20:39:57] [OnPostRequestReset] Attempting to send email
[INFO] [2025-05-10 20:39:57] [EmailService] Attempting to send OTP email to luckybrownandrew@gmail.com
[INFO] [2025-05-10 20:40:00] [EmailService] Successfully sent OTP email to luckybrownandrew@gmail.com
[INFO] [2025-05-10 20:40:00] [OnPostRequestReset] Email sent successfully
[INFO] [2025-05-10 20:41:08] [ForgotPasswordModel] Initializing ForgotPasswordModel
[INFO] [2025-05-10 20:41:08] [OtpService] Initialized with provided connection string
[INFO] [2025-05-10 20:41:08] [ForgotPasswordModel] Resending verification code
[INFO] [2025-05-10 20:41:08] [OtpService] Generated new OTP code: 233468
[INFO] [2025-05-10 20:41:08] [ForgotPasswordModel] Generated new OTP for resend: 233468
[INFO] [2025-05-10 20:41:08] [OtpService] Saving OTP for user ID: 28, Code: 233468
[INFO] [2025-05-10 20:41:08] [OtpService] Opening database connection
[INFO] [2025-05-10 20:41:08] [OtpService] Database connection opened successfully
[INFO] [2025-05-10 20:41:08] [OtpService] Transaction started
[INFO] [2025-05-10 20:41:08] [OtpService] Invalidated 1 existing OTPs for user ID: 28
[INFO] [2025-05-10 20:41:08] [OtpService] Executing SQL: INSERT INTO USER_OTPS (USER_ID, OTP_CODE, EXPIRATION_TIME, IS_VALID, CREATED_AT) 
                                          VALUES (@UserId, @OtpCode, DATEADD(MINUTE, 10, GETDATE()), 1, GETDATE()) with UserId=28, OtpCode=233468
[INFO] [2025-05-10 20:41:08] [OtpService] Inserted 1 new OTP records
[INFO] [2025-05-10 20:41:08] [OtpService] Committing transaction
[INFO] [2025-05-10 20:41:08] [OtpService] Transaction committed successfully
[INFO] [2025-05-10 20:41:08] [EmailService] Attempting to send OTP email to luckybrownandrew@gmail.com
[INFO] [2025-05-10 20:41:13] [EmailService] Successfully sent OTP email to luckybrownandrew@gmail.com
[INFO] [2025-05-10 20:41:13] [ForgotPasswordModel] Resend email result: True
[INFO] [2025-05-10 20:42:16] [ForgotPasswordModel] Initializing ForgotPasswordModel
[INFO] [2025-05-10 20:42:16] [OtpService] Initialized with provided connection string
[INFO] [2025-05-10 20:42:16] [ForgotPasswordModel] Verifying reset code
[INFO] [2025-05-10 20:42:17] [ForgotPasswordModel] Validating OTP for user: 28
[INFO] [2025-05-10 20:42:17] [OtpService] Validating OTP for user ID: 28, Code: 185178
[INFO] [2025-05-10 20:42:17] [OtpService] Using connection string: Data Source=ABAKAREKE_25497\SQLEXPRESS;Initial Catalog=ONLINE_LEARNING_PLATFORM;Integrated Security=True;TrustServerCertificate=True
[INFO] [2025-05-10 20:42:17] [OtpService] Opening database connection for validation
[INFO] [2025-05-10 20:42:17] [OtpService] Database connection opened successfully
[INFO] [2025-05-10 20:42:17] [OtpService] Verifying USER_OTPS table exists
[INFO] [2025-05-10 20:42:17] [OtpService] USER_OTPS table exists: True
[INFO] [2025-05-10 20:42:17] [OtpService] Found 2 OTP records for user ID: 28
[INFO] [2025-05-10 20:42:17] [OtpService] Executing validation SQL: SELECT COUNT(1) 
                      FROM USER_OTPS 
                      WHERE USER_ID = @UserId 
                      AND OTP_CODE = @OtpCode 
                      AND IS_VALID = 1 
                      AND EXPIRATION_TIME > GETDATE()
[INFO] [2025-05-10 20:42:17] [OtpService] Executing validation query
[INFO] [2025-05-10 20:42:18] [OtpService] Validation query returned: 0
[INFO] [2025-05-10 20:42:18] [OtpService] OTP validation failed for user ID: 28. Code: 185178
[INFO] [2025-05-10 20:42:18] [OtpService] Running diagnostic query for OTP failure analysis
[ERROR] [2025-05-10 20:42:18] [OtpService] Error validating OTP for user ID: 28
Exception: Incorrect syntax near the keyword 'CURRENT_TIME'.
Stack Trace:    at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, SqlCommand command, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryConsumeMetaData()
   at Microsoft.Data.SqlClient.SqlDataReader.get_MetaData()
   at Microsoft.Data.SqlClient.SqlCommand.FinishExecuteReader(SqlDataReader ds, RunBehavior runBehavior, String resetOptionsString, Boolean isInternal, Boolean forDescribeParameterEncryption, Boolean shouldCacheForAlwaysEncrypted)
   at Microsoft.Data.SqlClient.SqlCommand.RunExecuteReaderTds(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, Boolean isAsync, Int32 timeout, Task& task, Boolean asyncWrite, Boolean inRetry, SqlDataReader ds, Boolean describeParameterEncryptionRequest)
   at Microsoft.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, TaskCompletionSource`1 completion, Int32 timeout, Task& task, Boolean& usedCache, Boolean asyncWrite, Boolean inRetry, String method)
   at Microsoft.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String method)
   at Microsoft.Data.SqlClient.SqlCommand.ExecuteReader(CommandBehavior behavior)
   at Microsoft.Data.SqlClient.SqlCommand.ExecuteReader()
   at E_Learning_Platform.Pages.Services.OtpService.ValidateOtp(Int32 userId, String otpCode) in C:\Users\HP\Desktop\Dot-net\E-Learning-Platform\E-Learning-Platform\E-Learning-Platform\Pages\Services\OtpService.cs:line 199
--------------------------------------------------
[ERROR] [2025-05-10 20:42:18] [ForgotPasswordModel] Error verifying code
Exception: Error validating OTP: Incorrect syntax near the keyword 'CURRENT_TIME'.
Stack Trace:    at E_Learning_Platform.Pages.Services.OtpService.ValidateOtp(Int32 userId, String otpCode) in C:\Users\HP\Desktop\Dot-net\E-Learning-Platform\E-Learning-Platform\E-Learning-Platform\Pages\Services\OtpService.cs:line 246
   at E_Learning_Platform.Pages.ForgotPasswordModel.OnPostVerifyCodeAsync() in C:\Users\HP\Desktop\Dot-net\E-Learning-Platform\E-Learning-Platform\E-Learning-Platform\Pages\ForgotPassword.cshtml.cs:line 169
--------------------------------------------------
[INFO] [2025-05-10 20:42:22] [ForgotPasswordModel] Initializing ForgotPasswordModel
[INFO] [2025-05-10 20:42:22] [OtpService] Initialized with provided connection string
[INFO] [2025-05-10 20:42:22] [ForgotPasswordModel] Verifying reset code
[INFO] [2025-05-10 20:42:22] [ForgotPasswordModel] Validating OTP for user: 28
[INFO] [2025-05-10 20:42:22] [OtpService] Validating OTP for user ID: 28, Code: 185178
[INFO] [2025-05-10 20:42:22] [OtpService] Using connection string: Data Source=ABAKAREKE_25497\SQLEXPRESS;Initial Catalog=ONLINE_LEARNING_PLATFORM;Integrated Security=True;TrustServerCertificate=True
[INFO] [2025-05-10 20:42:22] [OtpService] Opening database connection for validation
[INFO] [2025-05-10 20:42:22] [OtpService] Database connection opened successfully
[INFO] [2025-05-10 20:42:22] [OtpService] Verifying USER_OTPS table exists
[INFO] [2025-05-10 20:42:23] [OtpService] USER_OTPS table exists: True
[INFO] [2025-05-10 20:42:23] [OtpService] Found 2 OTP records for user ID: 28
[INFO] [2025-05-10 20:42:23] [OtpService] Executing validation SQL: SELECT COUNT(1) 
                      FROM USER_OTPS 
                      WHERE USER_ID = @UserId 
                      AND OTP_CODE = @OtpCode 
                      AND IS_VALID = 1 
                      AND EXPIRATION_TIME > GETDATE()
[INFO] [2025-05-10 20:42:23] [OtpService] Executing validation query
[INFO] [2025-05-10 20:42:23] [OtpService] Validation query returned: 0
[INFO] [2025-05-10 20:42:23] [OtpService] OTP validation failed for user ID: 28. Code: 185178
[INFO] [2025-05-10 20:42:23] [OtpService] Running diagnostic query for OTP failure analysis
[ERROR] [2025-05-10 20:42:23] [OtpService] Error validating OTP for user ID: 28
Exception: Incorrect syntax near the keyword 'CURRENT_TIME'.
Stack Trace:    at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, SqlCommand command, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryConsumeMetaData()
   at Microsoft.Data.SqlClient.SqlDataReader.get_MetaData()
   at Microsoft.Data.SqlClient.SqlCommand.FinishExecuteReader(SqlDataReader ds, RunBehavior runBehavior, String resetOptionsString, Boolean isInternal, Boolean forDescribeParameterEncryption, Boolean shouldCacheForAlwaysEncrypted)
   at Microsoft.Data.SqlClient.SqlCommand.RunExecuteReaderTds(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, Boolean isAsync, Int32 timeout, Task& task, Boolean asyncWrite, Boolean inRetry, SqlDataReader ds, Boolean describeParameterEncryptionRequest)
   at Microsoft.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, TaskCompletionSource`1 completion, Int32 timeout, Task& task, Boolean& usedCache, Boolean asyncWrite, Boolean inRetry, String method)
   at Microsoft.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String method)
   at Microsoft.Data.SqlClient.SqlCommand.ExecuteReader(CommandBehavior behavior)
   at Microsoft.Data.SqlClient.SqlCommand.ExecuteReader()
   at E_Learning_Platform.Pages.Services.OtpService.ValidateOtp(Int32 userId, String otpCode) in C:\Users\HP\Desktop\Dot-net\E-Learning-Platform\E-Learning-Platform\E-Learning-Platform\Pages\Services\OtpService.cs:line 199
--------------------------------------------------
[ERROR] [2025-05-10 20:42:23] [ForgotPasswordModel] Error verifying code
Exception: Error validating OTP: Incorrect syntax near the keyword 'CURRENT_TIME'.
Stack Trace:    at E_Learning_Platform.Pages.Services.OtpService.ValidateOtp(Int32 userId, String otpCode) in C:\Users\HP\Desktop\Dot-net\E-Learning-Platform\E-Learning-Platform\E-Learning-Platform\Pages\Services\OtpService.cs:line 246
   at E_Learning_Platform.Pages.ForgotPasswordModel.OnPostVerifyCodeAsync() in C:\Users\HP\Desktop\Dot-net\E-Learning-Platform\E-Learning-Platform\E-Learning-Platform\Pages\ForgotPassword.cshtml.cs:line 169
--------------------------------------------------
[INFO] [2025-05-10 20:42:25] [ForgotPasswordModel] Initializing ForgotPasswordModel
[INFO] [2025-05-10 20:42:25] [OtpService] Initialized with provided connection string
[INFO] [2025-05-10 20:42:25] [ForgotPasswordModel] Verifying reset code
[INFO] [2025-05-10 20:42:25] [ForgotPasswordModel] Validating OTP for user: 28
[INFO] [2025-05-10 20:42:25] [OtpService] Validating OTP for user ID: 28, Code: 185178
[INFO] [2025-05-10 20:42:25] [OtpService] Using connection string: Data Source=ABAKAREKE_25497\SQLEXPRESS;Initial Catalog=ONLINE_LEARNING_PLATFORM;Integrated Security=True;TrustServerCertificate=True
[INFO] [2025-05-10 20:42:25] [OtpService] Opening database connection for validation
[INFO] [2025-05-10 20:42:25] [OtpService] Database connection opened successfully
[INFO] [2025-05-10 20:42:25] [OtpService] Verifying USER_OTPS table exists
[INFO] [2025-05-10 20:42:25] [OtpService] USER_OTPS table exists: True
[INFO] [2025-05-10 20:42:25] [OtpService] Found 2 OTP records for user ID: 28
[INFO] [2025-05-10 20:42:25] [OtpService] Executing validation SQL: SELECT COUNT(1) 
                      FROM USER_OTPS 
                      WHERE USER_ID = @UserId 
                      AND OTP_CODE = @OtpCode 
                      AND IS_VALID = 1 
                      AND EXPIRATION_TIME > GETDATE()
[INFO] [2025-05-10 20:42:25] [OtpService] Executing validation query
[INFO] [2025-05-10 20:42:25] [OtpService] Validation query returned: 0
[INFO] [2025-05-10 20:42:25] [OtpService] OTP validation failed for user ID: 28. Code: 185178
[INFO] [2025-05-10 20:42:25] [OtpService] Running diagnostic query for OTP failure analysis
[ERROR] [2025-05-10 20:42:25] [OtpService] Error validating OTP for user ID: 28
Exception: Incorrect syntax near the keyword 'CURRENT_TIME'.
Stack Trace:    at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, SqlCommand command, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryConsumeMetaData()
   at Microsoft.Data.SqlClient.SqlDataReader.get_MetaData()
   at Microsoft.Data.SqlClient.SqlCommand.FinishExecuteReader(SqlDataReader ds, RunBehavior runBehavior, String resetOptionsString, Boolean isInternal, Boolean forDescribeParameterEncryption, Boolean shouldCacheForAlwaysEncrypted)
   at Microsoft.Data.SqlClient.SqlCommand.RunExecuteReaderTds(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, Boolean isAsync, Int32 timeout, Task& task, Boolean asyncWrite, Boolean inRetry, SqlDataReader ds, Boolean describeParameterEncryptionRequest)
   at Microsoft.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, TaskCompletionSource`1 completion, Int32 timeout, Task& task, Boolean& usedCache, Boolean asyncWrite, Boolean inRetry, String method)
   at Microsoft.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String method)
   at Microsoft.Data.SqlClient.SqlCommand.ExecuteReader(CommandBehavior behavior)
   at Microsoft.Data.SqlClient.SqlCommand.ExecuteReader()
   at E_Learning_Platform.Pages.Services.OtpService.ValidateOtp(Int32 userId, String otpCode) in C:\Users\HP\Desktop\Dot-net\E-Learning-Platform\E-Learning-Platform\E-Learning-Platform\Pages\Services\OtpService.cs:line 199
--------------------------------------------------
[ERROR] [2025-05-10 20:42:25] [ForgotPasswordModel] Error verifying code
Exception: Error validating OTP: Incorrect syntax near the keyword 'CURRENT_TIME'.
Stack Trace:    at E_Learning_Platform.Pages.Services.OtpService.ValidateOtp(Int32 userId, String otpCode) in C:\Users\HP\Desktop\Dot-net\E-Learning-Platform\E-Learning-Platform\E-Learning-Platform\Pages\Services\OtpService.cs:line 246
   at E_Learning_Platform.Pages.ForgotPasswordModel.OnPostVerifyCodeAsync() in C:\Users\HP\Desktop\Dot-net\E-Learning-Platform\E-Learning-Platform\E-Learning-Platform\Pages\ForgotPassword.cshtml.cs:line 169
--------------------------------------------------
[INFO] [2025-05-10 20:42:51] [ForgotPasswordModel] Initializing ForgotPasswordModel
[INFO] [2025-05-10 20:42:51] [OtpService] Initialized with provided connection string
[INFO] [2025-05-10 20:42:51] [ForgotPasswordModel] Verifying reset code
[INFO] [2025-05-10 20:42:51] [ForgotPasswordModel] Validating OTP for user: 28
[INFO] [2025-05-10 20:42:51] [OtpService] Validating OTP for user ID: 28, Code: 185178
[INFO] [2025-05-10 20:42:51] [OtpService] Using connection string: Data Source=ABAKAREKE_25497\SQLEXPRESS;Initial Catalog=ONLINE_LEARNING_PLATFORM;Integrated Security=True;TrustServerCertificate=True
[INFO] [2025-05-10 20:42:51] [OtpService] Opening database connection for validation
[INFO] [2025-05-10 20:42:51] [OtpService] Database connection opened successfully
[INFO] [2025-05-10 20:42:51] [OtpService] Verifying USER_OTPS table exists
[INFO] [2025-05-10 20:42:51] [OtpService] USER_OTPS table exists: True
[INFO] [2025-05-10 20:42:51] [OtpService] Found 2 OTP records for user ID: 28
[INFO] [2025-05-10 20:42:51] [OtpService] Executing validation SQL: SELECT COUNT(1) 
                      FROM USER_OTPS 
                      WHERE USER_ID = @UserId 
                      AND OTP_CODE = @OtpCode 
                      AND IS_VALID = 1 
                      AND EXPIRATION_TIME > GETDATE()
[INFO] [2025-05-10 20:42:51] [OtpService] Executing validation query
[INFO] [2025-05-10 20:42:51] [OtpService] Validation query returned: 0
[INFO] [2025-05-10 20:42:51] [OtpService] OTP validation failed for user ID: 28. Code: 185178
[INFO] [2025-05-10 20:42:51] [OtpService] Running diagnostic query for OTP failure analysis
[ERROR] [2025-05-10 20:42:51] [OtpService] Error validating OTP for user ID: 28
Exception: Incorrect syntax near the keyword 'CURRENT_TIME'.
Stack Trace:    at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, SqlCommand command, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryConsumeMetaData()
   at Microsoft.Data.SqlClient.SqlDataReader.get_MetaData()
   at Microsoft.Data.SqlClient.SqlCommand.FinishExecuteReader(SqlDataReader ds, RunBehavior runBehavior, String resetOptionsString, Boolean isInternal, Boolean forDescribeParameterEncryption, Boolean shouldCacheForAlwaysEncrypted)
   at Microsoft.Data.SqlClient.SqlCommand.RunExecuteReaderTds(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, Boolean isAsync, Int32 timeout, Task& task, Boolean asyncWrite, Boolean inRetry, SqlDataReader ds, Boolean describeParameterEncryptionRequest)
   at Microsoft.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, TaskCompletionSource`1 completion, Int32 timeout, Task& task, Boolean& usedCache, Boolean asyncWrite, Boolean inRetry, String method)
   at Microsoft.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String method)
   at Microsoft.Data.SqlClient.SqlCommand.ExecuteReader(CommandBehavior behavior)
   at Microsoft.Data.SqlClient.SqlCommand.ExecuteReader()
   at E_Learning_Platform.Pages.Services.OtpService.ValidateOtp(Int32 userId, String otpCode) in C:\Users\HP\Desktop\Dot-net\E-Learning-Platform\E-Learning-Platform\E-Learning-Platform\Pages\Services\OtpService.cs:line 199
--------------------------------------------------
[ERROR] [2025-05-10 20:42:51] [ForgotPasswordModel] Error verifying code
Exception: Error validating OTP: Incorrect syntax near the keyword 'CURRENT_TIME'.
Stack Trace:    at E_Learning_Platform.Pages.Services.OtpService.ValidateOtp(Int32 userId, String otpCode) in C:\Users\HP\Desktop\Dot-net\E-Learning-Platform\E-Learning-Platform\E-Learning-Platform\Pages\Services\OtpService.cs:line 246
   at E_Learning_Platform.Pages.ForgotPasswordModel.OnPostVerifyCodeAsync() in C:\Users\HP\Desktop\Dot-net\E-Learning-Platform\E-Learning-Platform\E-Learning-Platform\Pages\ForgotPassword.cshtml.cs:line 169
--------------------------------------------------
[INFO] [2025-05-10 20:42:52] [ForgotPasswordModel] Initializing ForgotPasswordModel
[INFO] [2025-05-10 20:42:52] [OtpService] Initialized with provided connection string
[INFO] [2025-05-10 20:42:53] [ForgotPasswordModel] Verifying reset code
[INFO] [2025-05-10 20:42:53] [ForgotPasswordModel] Validating OTP for user: 28
[INFO] [2025-05-10 20:42:53] [OtpService] Validating OTP for user ID: 28, Code: 185178
[INFO] [2025-05-10 20:42:53] [OtpService] Using connection string: Data Source=ABAKAREKE_25497\SQLEXPRESS;Initial Catalog=ONLINE_LEARNING_PLATFORM;Integrated Security=True;TrustServerCertificate=True
[INFO] [2025-05-10 20:42:53] [OtpService] Opening database connection for validation
[INFO] [2025-05-10 20:42:53] [OtpService] Database connection opened successfully
[INFO] [2025-05-10 20:42:53] [OtpService] Verifying USER_OTPS table exists
[INFO] [2025-05-10 20:42:53] [OtpService] USER_OTPS table exists: True
[INFO] [2025-05-10 20:42:53] [OtpService] Found 2 OTP records for user ID: 28
[INFO] [2025-05-10 20:42:53] [OtpService] Executing validation SQL: SELECT COUNT(1) 
                      FROM USER_OTPS 
                      WHERE USER_ID = @UserId 
                      AND OTP_CODE = @OtpCode 
                      AND IS_VALID = 1 
                      AND EXPIRATION_TIME > GETDATE()
[INFO] [2025-05-10 20:42:53] [OtpService] Executing validation query
[INFO] [2025-05-10 20:42:53] [OtpService] Validation query returned: 0
[INFO] [2025-05-10 20:42:53] [OtpService] OTP validation failed for user ID: 28. Code: 185178
[INFO] [2025-05-10 20:42:53] [OtpService] Running diagnostic query for OTP failure analysis
[ERROR] [2025-05-10 20:42:53] [OtpService] Error validating OTP for user ID: 28
Exception: Incorrect syntax near the keyword 'CURRENT_TIME'.
Stack Trace:    at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, SqlCommand command, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryConsumeMetaData()
   at Microsoft.Data.SqlClient.SqlDataReader.get_MetaData()
   at Microsoft.Data.SqlClient.SqlCommand.FinishExecuteReader(SqlDataReader ds, RunBehavior runBehavior, String resetOptionsString, Boolean isInternal, Boolean forDescribeParameterEncryption, Boolean shouldCacheForAlwaysEncrypted)
   at Microsoft.Data.SqlClient.SqlCommand.RunExecuteReaderTds(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, Boolean isAsync, Int32 timeout, Task& task, Boolean asyncWrite, Boolean inRetry, SqlDataReader ds, Boolean describeParameterEncryptionRequest)
   at Microsoft.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, TaskCompletionSource`1 completion, Int32 timeout, Task& task, Boolean& usedCache, Boolean asyncWrite, Boolean inRetry, String method)
   at Microsoft.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String method)
   at Microsoft.Data.SqlClient.SqlCommand.ExecuteReader(CommandBehavior behavior)
   at Microsoft.Data.SqlClient.SqlCommand.ExecuteReader()
   at E_Learning_Platform.Pages.Services.OtpService.ValidateOtp(Int32 userId, String otpCode) in C:\Users\HP\Desktop\Dot-net\E-Learning-Platform\E-Learning-Platform\E-Learning-Platform\Pages\Services\OtpService.cs:line 199
--------------------------------------------------
[ERROR] [2025-05-10 20:42:53] [ForgotPasswordModel] Error verifying code
Exception: Error validating OTP: Incorrect syntax near the keyword 'CURRENT_TIME'.
Stack Trace:    at E_Learning_Platform.Pages.Services.OtpService.ValidateOtp(Int32 userId, String otpCode) in C:\Users\HP\Desktop\Dot-net\E-Learning-Platform\E-Learning-Platform\E-Learning-Platform\Pages\Services\OtpService.cs:line 246
   at E_Learning_Platform.Pages.ForgotPasswordModel.OnPostVerifyCodeAsync() in C:\Users\HP\Desktop\Dot-net\E-Learning-Platform\E-Learning-Platform\E-Learning-Platform\Pages\ForgotPassword.cshtml.cs:line 169
--------------------------------------------------
[INFO] [2025-05-10 20:42:53] [ForgotPasswordModel] Initializing ForgotPasswordModel
[INFO] [2025-05-10 20:42:53] [OtpService] Initialized with provided connection string
[INFO] [2025-05-10 20:42:53] [ForgotPasswordModel] Verifying reset code
[INFO] [2025-05-10 20:42:53] [ForgotPasswordModel] Validating OTP for user: 28
[INFO] [2025-05-10 20:42:53] [OtpService] Validating OTP for user ID: 28, Code: 185178
[INFO] [2025-05-10 20:42:53] [OtpService] Using connection string: Data Source=ABAKAREKE_25497\SQLEXPRESS;Initial Catalog=ONLINE_LEARNING_PLATFORM;Integrated Security=True;TrustServerCertificate=True
[INFO] [2025-05-10 20:42:53] [OtpService] Opening database connection for validation
[INFO] [2025-05-10 20:42:53] [OtpService] Database connection opened successfully
[INFO] [2025-05-10 20:42:53] [OtpService] Verifying USER_OTPS table exists
[INFO] [2025-05-10 20:42:53] [OtpService] USER_OTPS table exists: True
[INFO] [2025-05-10 20:42:53] [OtpService] Found 2 OTP records for user ID: 28
[INFO] [2025-05-10 20:42:53] [OtpService] Executing validation SQL: SELECT COUNT(1) 
                      FROM USER_OTPS 
                      WHERE USER_ID = @UserId 
                      AND OTP_CODE = @OtpCode 
                      AND IS_VALID = 1 
                      AND EXPIRATION_TIME > GETDATE()
[INFO] [2025-05-10 20:42:53] [OtpService] Executing validation query
[INFO] [2025-05-10 20:42:53] [OtpService] Validation query returned: 0
[INFO] [2025-05-10 20:42:53] [OtpService] OTP validation failed for user ID: 28. Code: 185178
[INFO] [2025-05-10 20:42:53] [OtpService] Running diagnostic query for OTP failure analysis
[ERROR] [2025-05-10 20:42:53] [OtpService] Error validating OTP for user ID: 28
Exception: Incorrect syntax near the keyword 'CURRENT_TIME'.
Stack Trace:    at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, SqlCommand command, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryConsumeMetaData()
   at Microsoft.Data.SqlClient.SqlDataReader.get_MetaData()
   at Microsoft.Data.SqlClient.SqlCommand.FinishExecuteReader(SqlDataReader ds, RunBehavior runBehavior, String resetOptionsString, Boolean isInternal, Boolean forDescribeParameterEncryption, Boolean shouldCacheForAlwaysEncrypted)
   at Microsoft.Data.SqlClient.SqlCommand.RunExecuteReaderTds(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, Boolean isAsync, Int32 timeout, Task& task, Boolean asyncWrite, Boolean inRetry, SqlDataReader ds, Boolean describeParameterEncryptionRequest)
   at Microsoft.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, TaskCompletionSource`1 completion, Int32 timeout, Task& task, Boolean& usedCache, Boolean asyncWrite, Boolean inRetry, String method)
   at Microsoft.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String method)
   at Microsoft.Data.SqlClient.SqlCommand.ExecuteReader(CommandBehavior behavior)
   at Microsoft.Data.SqlClient.SqlCommand.ExecuteReader()
   at E_Learning_Platform.Pages.Services.OtpService.ValidateOtp(Int32 userId, String otpCode) in C:\Users\HP\Desktop\Dot-net\E-Learning-Platform\E-Learning-Platform\E-Learning-Platform\Pages\Services\OtpService.cs:line 199
--------------------------------------------------
[ERROR] [2025-05-10 20:42:53] [ForgotPasswordModel] Error verifying code
Exception: Error validating OTP: Incorrect syntax near the keyword 'CURRENT_TIME'.
Stack Trace:    at E_Learning_Platform.Pages.Services.OtpService.ValidateOtp(Int32 userId, String otpCode) in C:\Users\HP\Desktop\Dot-net\E-Learning-Platform\E-Learning-Platform\E-Learning-Platform\Pages\Services\OtpService.cs:line 246
   at E_Learning_Platform.Pages.ForgotPasswordModel.OnPostVerifyCodeAsync() in C:\Users\HP\Desktop\Dot-net\E-Learning-Platform\E-Learning-Platform\E-Learning-Platform\Pages\ForgotPassword.cshtml.cs:line 169
--------------------------------------------------
[INFO] [2025-05-10 20:42:54] [ForgotPasswordModel] Initializing ForgotPasswordModel
[INFO] [2025-05-10 20:42:54] [OtpService] Initialized with provided connection string
[INFO] [2025-05-10 20:42:54] [ForgotPasswordModel] Verifying reset code
[INFO] [2025-05-10 20:42:54] [ForgotPasswordModel] Validating OTP for user: 28
[INFO] [2025-05-10 20:42:54] [OtpService] Validating OTP for user ID: 28, Code: 185178
[INFO] [2025-05-10 20:42:54] [OtpService] Using connection string: Data Source=ABAKAREKE_25497\SQLEXPRESS;Initial Catalog=ONLINE_LEARNING_PLATFORM;Integrated Security=True;TrustServerCertificate=True
[INFO] [2025-05-10 20:42:54] [OtpService] Opening database connection for validation
[INFO] [2025-05-10 20:42:54] [OtpService] Database connection opened successfully
[INFO] [2025-05-10 20:42:54] [OtpService] Verifying USER_OTPS table exists
[INFO] [2025-05-10 20:42:54] [OtpService] USER_OTPS table exists: True
[INFO] [2025-05-10 20:42:54] [OtpService] Found 2 OTP records for user ID: 28
[INFO] [2025-05-10 20:42:54] [OtpService] Executing validation SQL: SELECT COUNT(1) 
                      FROM USER_OTPS 
                      WHERE USER_ID = @UserId 
                      AND OTP_CODE = @OtpCode 
                      AND IS_VALID = 1 
                      AND EXPIRATION_TIME > GETDATE()
[INFO] [2025-05-10 20:42:54] [OtpService] Executing validation query
[INFO] [2025-05-10 20:42:55] [OtpService] Validation query returned: 0
[INFO] [2025-05-10 20:42:55] [OtpService] OTP validation failed for user ID: 28. Code: 185178
[INFO] [2025-05-10 20:42:55] [OtpService] Running diagnostic query for OTP failure analysis
[ERROR] [2025-05-10 20:42:55] [OtpService] Error validating OTP for user ID: 28
Exception: Incorrect syntax near the keyword 'CURRENT_TIME'.
Stack Trace:    at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, SqlCommand command, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryConsumeMetaData()
   at Microsoft.Data.SqlClient.SqlDataReader.get_MetaData()
   at Microsoft.Data.SqlClient.SqlCommand.FinishExecuteReader(SqlDataReader ds, RunBehavior runBehavior, String resetOptionsString, Boolean isInternal, Boolean forDescribeParameterEncryption, Boolean shouldCacheForAlwaysEncrypted)
   at Microsoft.Data.SqlClient.SqlCommand.RunExecuteReaderTds(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, Boolean isAsync, Int32 timeout, Task& task, Boolean asyncWrite, Boolean inRetry, SqlDataReader ds, Boolean describeParameterEncryptionRequest)
   at Microsoft.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, TaskCompletionSource`1 completion, Int32 timeout, Task& task, Boolean& usedCache, Boolean asyncWrite, Boolean inRetry, String method)
   at Microsoft.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String method)
   at Microsoft.Data.SqlClient.SqlCommand.ExecuteReader(CommandBehavior behavior)
   at Microsoft.Data.SqlClient.SqlCommand.ExecuteReader()
   at E_Learning_Platform.Pages.Services.OtpService.ValidateOtp(Int32 userId, String otpCode) in C:\Users\HP\Desktop\Dot-net\E-Learning-Platform\E-Learning-Platform\E-Learning-Platform\Pages\Services\OtpService.cs:line 199
--------------------------------------------------
[ERROR] [2025-05-10 20:42:55] [ForgotPasswordModel] Error verifying code
Exception: Error validating OTP: Incorrect syntax near the keyword 'CURRENT_TIME'.
Stack Trace:    at E_Learning_Platform.Pages.Services.OtpService.ValidateOtp(Int32 userId, String otpCode) in C:\Users\HP\Desktop\Dot-net\E-Learning-Platform\E-Learning-Platform\E-Learning-Platform\Pages\Services\OtpService.cs:line 246
   at E_Learning_Platform.Pages.ForgotPasswordModel.OnPostVerifyCodeAsync() in C:\Users\HP\Desktop\Dot-net\E-Learning-Platform\E-Learning-Platform\E-Learning-Platform\Pages\ForgotPassword.cshtml.cs:line 169
--------------------------------------------------
[INFO] [2025-05-10 20:43:23] [ForgotPasswordModel] Initializing ForgotPasswordModel
[INFO] [2025-05-10 20:43:23] [OtpService] Initialized with provided connection string
[INFO] [2025-05-10 20:43:23] [ForgotPasswordModel] Verifying reset code
[INFO] [2025-05-10 20:43:23] [ForgotPasswordModel] Validating OTP for user: 28
[INFO] [2025-05-10 20:43:23] [OtpService] Validating OTP for user ID: 28, Code: 233468
[INFO] [2025-05-10 20:43:23] [OtpService] Using connection string: Data Source=ABAKAREKE_25497\SQLEXPRESS;Initial Catalog=ONLINE_LEARNING_PLATFORM;Integrated Security=True;TrustServerCertificate=True
[INFO] [2025-05-10 20:43:23] [OtpService] Opening database connection for validation
[INFO] [2025-05-10 20:43:23] [OtpService] Database connection opened successfully
[INFO] [2025-05-10 20:43:23] [OtpService] Verifying USER_OTPS table exists
[INFO] [2025-05-10 20:43:23] [OtpService] USER_OTPS table exists: True
[INFO] [2025-05-10 20:43:23] [OtpService] Found 2 OTP records for user ID: 28
[INFO] [2025-05-10 20:43:23] [OtpService] Executing validation SQL: SELECT COUNT(1) 
                      FROM USER_OTPS 
                      WHERE USER_ID = @UserId 
                      AND OTP_CODE = @OtpCode 
                      AND IS_VALID = 1 
                      AND EXPIRATION_TIME > GETDATE()
[INFO] [2025-05-10 20:43:23] [OtpService] Executing validation query
[INFO] [2025-05-10 20:43:23] [OtpService] Validation query returned: 1
[INFO] [2025-05-10 20:43:23] [OtpService] OTP validation successful for user ID: 28
[INFO] [2025-05-10 20:43:23] [ForgotPasswordModel] OTP validation result: True
[INFO] [2025-05-10 20:43:23] [ForgotPasswordModel] OTP validation successful
[INFO] [2025-05-10 20:43:23] [OtpService] Marking OTP as used for user ID: 28, Code: 233468
[INFO] [2025-05-10 20:43:23] [OtpService] Opening database connection
[INFO] [2025-05-10 20:43:23] [OtpService] Database connection opened successfully
[INFO] [2025-05-10 20:43:23] [OtpService] Marked 1 OTP records as used for user ID: 28
[INFO] [2025-05-10 20:43:48] [ForgotPasswordModel] Initializing ForgotPasswordModel
[INFO] [2025-05-10 20:43:48] [OtpService] Initialized with provided connection string
[INFO] [2025-05-10 20:43:48] [ForgotPasswordModel] Processing password reset
[INFO] [2025-05-10 20:43:48] [ForgotPasswordModel] Invalid model state for password reset
[INFO] [2025-05-10 20:44:09] [ForgotPasswordModel] Initializing ForgotPasswordModel
[INFO] [2025-05-10 20:44:09] [OtpService] Initialized with provided connection string
[INFO] [2025-05-10 20:44:09] [ForgotPasswordModel] Processing password reset
[INFO] [2025-05-10 20:44:09] [ForgotPasswordModel] Invalid model state for password reset
[INFO] [2025-05-10 20:56:54] [OtpService] Initialized with default connection string
[INFO] [2025-05-10 20:56:56] [ForgotPasswordModel] Initializing ForgotPasswordModel
[INFO] [2025-05-10 20:56:56] [OtpService] Initialized with provided connection string
[INFO] [2025-05-10 20:56:56] [ForgotPasswordModel] Loading forgot password page
[INFO] [2025-05-10 20:57:53] [ForgotPasswordModel] Initializing ForgotPasswordModel
[INFO] [2025-05-10 20:57:53] [OtpService] Initialized with provided connection string
[INFO] [2025-05-10 20:57:53] [OnPostRequestReset] Method started
[INFO] [2025-05-10 20:57:53] [OnPostRequestReset] Checking email existence: luckybrownandrew@gmail.com
[INFO] [2025-05-10 20:57:54] [ForgotPasswordModel] Checking if email exists: luckybrownandrew@gmail.com
[INFO] [2025-05-10 20:57:54] [ForgotPasswordModel] Email exists check result: True
[INFO] [2025-05-10 20:57:54] [OnPostRequestReset] Email found, getting user ID
[INFO] [2025-05-10 20:57:54] [ForgotPasswordModel] Getting user ID for email: luckybrownandrew@gmail.com
[INFO] [2025-05-10 20:57:54] [ForgotPasswordModel] Found user ID: 28
[INFO] [2025-05-10 20:57:54] [OnPostRequestReset] User ID found: 28
[INFO] [2025-05-10 20:57:54] [OtpService] Generated new OTP code: 579276
[INFO] [2025-05-10 20:57:54] [OnPostRequestReset] Generated OTP: 579276
[INFO] [2025-05-10 20:57:54] [OtpService] Saving OTP for user ID: 28, Code: 579276
[INFO] [2025-05-10 20:57:54] [OtpService] Opening database connection
[INFO] [2025-05-10 20:57:54] [OtpService] Database connection opened successfully
[INFO] [2025-05-10 20:57:54] [OtpService] Transaction started
[INFO] [2025-05-10 20:57:54] [OtpService] Invalidated 2 existing OTPs for user ID: 28
[INFO] [2025-05-10 20:57:54] [OtpService] Executing SQL: INSERT INTO USER_OTPS (USER_ID, OTP_CODE, EXPIRATION_TIME, IS_VALID, CREATED_AT) 
                                          VALUES (@UserId, @OtpCode, DATEADD(MINUTE, 10, GETDATE()), 1, GETDATE()) with UserId=28, OtpCode=579276
[INFO] [2025-05-10 20:57:54] [OtpService] Inserted 1 new OTP records
[INFO] [2025-05-10 20:57:54] [OtpService] Committing transaction
[INFO] [2025-05-10 20:57:54] [OtpService] Transaction committed successfully
[INFO] [2025-05-10 20:57:54] [OnPostRequestReset] Attempting to send email
[INFO] [2025-05-10 20:57:54] [EmailService] Attempting to send OTP email to luckybrownandrew@gmail.com
[INFO] [2025-05-10 20:57:59] [EmailService] Successfully sent OTP email to luckybrownandrew@gmail.com
[INFO] [2025-05-10 20:57:59] [OnPostRequestReset] Email sent successfully
[INFO] [2025-05-10 20:58:21] [ForgotPasswordModel] Initializing ForgotPasswordModel
[INFO] [2025-05-10 20:58:21] [OtpService] Initialized with provided connection string
[INFO] [2025-05-10 20:58:21] [ForgotPasswordModel] Verifying reset code
[INFO] [2025-05-10 20:58:21] [ForgotPasswordModel] Validating OTP for user: 28
[INFO] [2025-05-10 20:58:21] [OtpService] Validating OTP for user ID: 28, Code: 579276
[INFO] [2025-05-10 20:58:21] [OtpService] Using connection string: Data Source=ABAKAREKE_25497\SQLEXPRESS;Initial Catalog=ONLINE_LEARNING_PLATFORM;Integrated Security=True;TrustServerCertificate=True
[INFO] [2025-05-10 20:58:21] [OtpService] Opening database connection for validation
[INFO] [2025-05-10 20:58:21] [OtpService] Database connection opened successfully
[INFO] [2025-05-10 20:58:21] [OtpService] Verifying USER_OTPS table exists
[INFO] [2025-05-10 20:58:21] [OtpService] USER_OTPS table exists: True
[INFO] [2025-05-10 20:58:21] [OtpService] Found 3 OTP records for user ID: 28
[INFO] [2025-05-10 20:58:21] [OtpService] Executing validation SQL: SELECT COUNT(1) 
                      FROM USER_OTPS 
                      WHERE USER_ID = @UserId 
                      AND OTP_CODE = @OtpCode 
                      AND IS_VALID = 1 
                      AND EXPIRATION_TIME > GETDATE()
[INFO] [2025-05-10 20:58:21] [OtpService] Executing validation query
[INFO] [2025-05-10 20:58:21] [OtpService] Validation query returned: 1
[INFO] [2025-05-10 20:58:21] [OtpService] OTP validation successful for user ID: 28
[INFO] [2025-05-10 20:58:21] [ForgotPasswordModel] OTP validation result: True
[INFO] [2025-05-10 20:58:21] [ForgotPasswordModel] OTP validation successful
[INFO] [2025-05-10 20:58:21] [OtpService] Marking OTP as used for user ID: 28, Code: 579276
[INFO] [2025-05-10 20:58:21] [OtpService] Opening database connection
[INFO] [2025-05-10 20:58:21] [OtpService] Database connection opened successfully
[INFO] [2025-05-10 20:58:21] [OtpService] Marked 1 OTP records as used for user ID: 28
[INFO] [2025-05-10 20:58:45] [ForgotPasswordModel] Initializing ForgotPasswordModel
[INFO] [2025-05-10 20:58:45] [OtpService] Initialized with provided connection string
[INFO] [2025-05-10 20:58:45] [ForgotPasswordModel] Processing password reset
[INFO] [2025-05-10 20:58:45] [ForgotPasswordModel] Invalid model state for password reset
[INFO] [2025-05-10 20:59:28] [ForgotPasswordModel] Initializing ForgotPasswordModel
[INFO] [2025-05-10 20:59:28] [OtpService] Initialized with provided connection string
[INFO] [2025-05-10 20:59:28] [ForgotPasswordModel] Processing password reset
[INFO] [2025-05-10 20:59:28] [ForgotPasswordModel] Invalid model state for password reset
[INFO] [2025-05-10 20:59:53] [ForgotPasswordModel] Initializing ForgotPasswordModel
[INFO] [2025-05-10 20:59:53] [OtpService] Initialized with provided connection string
[INFO] [2025-05-10 20:59:53] [ForgotPasswordModel] Loading forgot password page
[INFO] [2025-05-10 20:59:58] [ForgotPasswordModel] Initializing ForgotPasswordModel
[INFO] [2025-05-10 20:59:58] [OtpService] Initialized with provided connection string
[INFO] [2025-05-10 20:59:58] [OnPostRequestReset] Method started
[INFO] [2025-05-10 20:59:58] [OnPostRequestReset] Checking email existence: luckybrownandrew@gmail.com
[INFO] [2025-05-10 20:59:58] [ForgotPasswordModel] Checking if email exists: luckybrownandrew@gmail.com
[INFO] [2025-05-10 20:59:58] [ForgotPasswordModel] Email exists check result: True
[INFO] [2025-05-10 20:59:58] [OnPostRequestReset] Email found, getting user ID
[INFO] [2025-05-10 20:59:58] [ForgotPasswordModel] Getting user ID for email: luckybrownandrew@gmail.com
[INFO] [2025-05-10 20:59:58] [ForgotPasswordModel] Found user ID: 28
[INFO] [2025-05-10 20:59:58] [OnPostRequestReset] User ID found: 28
[INFO] [2025-05-10 20:59:58] [OtpService] Generated new OTP code: 221172
[INFO] [2025-05-10 20:59:58] [OnPostRequestReset] Generated OTP: 221172
[INFO] [2025-05-10 20:59:58] [OtpService] Saving OTP for user ID: 28, Code: 221172
[INFO] [2025-05-10 20:59:58] [OtpService] Opening database connection
[INFO] [2025-05-10 20:59:58] [OtpService] Database connection opened successfully
[INFO] [2025-05-10 20:59:58] [OtpService] Transaction started
[INFO] [2025-05-10 20:59:58] [OtpService] Invalidated 3 existing OTPs for user ID: 28
[INFO] [2025-05-10 20:59:58] [OtpService] Executing SQL: INSERT INTO USER_OTPS (USER_ID, OTP_CODE, EXPIRATION_TIME, IS_VALID, CREATED_AT) 
                                          VALUES (@UserId, @OtpCode, DATEADD(MINUTE, 10, GETDATE()), 1, GETDATE()) with UserId=28, OtpCode=221172
[INFO] [2025-05-10 20:59:58] [OtpService] Inserted 1 new OTP records
[INFO] [2025-05-10 20:59:58] [OtpService] Committing transaction
[INFO] [2025-05-10 20:59:58] [OtpService] Transaction committed successfully
[INFO] [2025-05-10 20:59:58] [OnPostRequestReset] Attempting to send email
[INFO] [2025-05-10 20:59:58] [EmailService] Attempting to send OTP email to luckybrownandrew@gmail.com
[INFO] [2025-05-10 21:00:01] [EmailService] Successfully sent OTP email to luckybrownandrew@gmail.com
[INFO] [2025-05-10 21:00:01] [OnPostRequestReset] Email sent successfully
[INFO] [2025-05-10 21:00:25] [ForgotPasswordModel] Initializing ForgotPasswordModel
[INFO] [2025-05-10 21:00:25] [OtpService] Initialized with provided connection string
[INFO] [2025-05-10 21:00:25] [ForgotPasswordModel] Verifying reset code
[INFO] [2025-05-10 21:00:25] [ForgotPasswordModel] Validating OTP for user: 28
[INFO] [2025-05-10 21:00:25] [OtpService] Validating OTP for user ID: 28, Code: 221172
[INFO] [2025-05-10 21:00:25] [OtpService] Using connection string: Data Source=ABAKAREKE_25497\SQLEXPRESS;Initial Catalog=ONLINE_LEARNING_PLATFORM;Integrated Security=True;TrustServerCertificate=True
[INFO] [2025-05-10 21:00:25] [OtpService] Opening database connection for validation
[INFO] [2025-05-10 21:00:25] [OtpService] Database connection opened successfully
[INFO] [2025-05-10 21:00:25] [OtpService] Verifying USER_OTPS table exists
[INFO] [2025-05-10 21:00:25] [OtpService] USER_OTPS table exists: True
[INFO] [2025-05-10 21:00:25] [OtpService] Found 4 OTP records for user ID: 28
[INFO] [2025-05-10 21:00:25] [OtpService] Executing validation SQL: SELECT COUNT(1) 
                      FROM USER_OTPS 
                      WHERE USER_ID = @UserId 
                      AND OTP_CODE = @OtpCode 
                      AND IS_VALID = 1 
                      AND EXPIRATION_TIME > GETDATE()
[INFO] [2025-05-10 21:00:25] [OtpService] Executing validation query
[INFO] [2025-05-10 21:00:25] [OtpService] Validation query returned: 1
[INFO] [2025-05-10 21:00:25] [OtpService] OTP validation successful for user ID: 28
[INFO] [2025-05-10 21:00:25] [ForgotPasswordModel] OTP validation result: True
[INFO] [2025-05-10 21:00:25] [ForgotPasswordModel] OTP validation successful
[INFO] [2025-05-10 21:00:25] [OtpService] Marking OTP as used for user ID: 28, Code: 221172
[INFO] [2025-05-10 21:00:25] [OtpService] Opening database connection
[INFO] [2025-05-10 21:00:25] [OtpService] Database connection opened successfully
[INFO] [2025-05-10 21:00:25] [OtpService] Marked 1 OTP records as used for user ID: 28
[INFO] [2025-05-10 21:02:50] [ForgotPasswordModel] Initializing ForgotPasswordModel
[INFO] [2025-05-10 21:02:50] [OtpService] Initialized with provided connection string
[INFO] [2025-05-10 21:02:50] [ForgotPasswordModel] Processing password reset
[INFO] [2025-05-10 21:02:50] [ForgotPasswordModel] Invalid model state for password reset
[INFO] [2025-05-10 21:21:09] [OtpService] Initialized with default connection string
[INFO] [2025-05-10 21:21:10] [ForgotPasswordModel] Initializing ForgotPasswordModel
[INFO] [2025-05-10 21:21:10] [OtpService] Initialized with provided connection string
[INFO] [2025-05-10 21:21:10] [ForgotPasswordModel] Loading forgot password page
[INFO] [2025-05-10 21:21:17] [ForgotPasswordModel] Initializing ForgotPasswordModel
[INFO] [2025-05-10 21:21:17] [OtpService] Initialized with provided connection string
[INFO] [2025-05-10 21:21:17] [OnPostRequestReset] Method started
[INFO] [2025-05-10 21:21:17] [OnPostRequestReset] Checking email existence: luckybrownandrew@gmail.com
[INFO] [2025-05-10 21:21:17] [ForgotPasswordModel] Checking if email exists: luckybrownandrew@gmail.com
[INFO] [2025-05-10 21:21:17] [ForgotPasswordModel] Email exists check result: True
[INFO] [2025-05-10 21:21:17] [OnPostRequestReset] Email found, getting user ID
[INFO] [2025-05-10 21:21:17] [ForgotPasswordModel] Getting user ID for email: luckybrownandrew@gmail.com
[INFO] [2025-05-10 21:21:17] [ForgotPasswordModel] Found user ID: 28
[INFO] [2025-05-10 21:21:17] [OnPostRequestReset] User ID found: 28
[INFO] [2025-05-10 21:21:17] [OtpService] Generated new OTP code: 635741
[INFO] [2025-05-10 21:21:17] [OnPostRequestReset] Generated OTP: 635741
[INFO] [2025-05-10 21:21:17] [OtpService] Saving OTP for user ID: 28, Code: 635741
[INFO] [2025-05-10 21:21:17] [OtpService] Opening database connection
[INFO] [2025-05-10 21:21:17] [OtpService] Database connection opened successfully
[INFO] [2025-05-10 21:21:17] [OtpService] Transaction started
[INFO] [2025-05-10 21:21:17] [OtpService] Invalidated 4 existing OTPs for user ID: 28
[INFO] [2025-05-10 21:21:17] [OtpService] Executing SQL: INSERT INTO USER_OTPS (USER_ID, OTP_CODE, EXPIRATION_TIME, IS_VALID, CREATED_AT) 
                                          VALUES (@UserId, @OtpCode, DATEADD(MINUTE, 10, GETDATE()), 1, GETDATE()) with UserId=28, OtpCode=635741
[INFO] [2025-05-10 21:21:17] [OtpService] Inserted 1 new OTP records
[INFO] [2025-05-10 21:21:17] [OtpService] Committing transaction
[INFO] [2025-05-10 21:21:17] [OtpService] Transaction committed successfully
[INFO] [2025-05-10 21:21:17] [OnPostRequestReset] Attempting to send email
[INFO] [2025-05-10 21:21:17] [EmailService] Attempting to send OTP email to luckybrownandrew@gmail.com
[INFO] [2025-05-10 21:21:21] [EmailService] Successfully sent OTP email to luckybrownandrew@gmail.com
[INFO] [2025-05-10 21:21:21] [OnPostRequestReset] Email sent successfully
[INFO] [2025-05-10 21:21:40] [ForgotPasswordModel] Initializing ForgotPasswordModel
[INFO] [2025-05-10 21:21:40] [OtpService] Initialized with provided connection string
[INFO] [2025-05-10 21:21:40] [ForgotPasswordModel] Verifying reset code
[INFO] [2025-05-10 21:21:40] [ForgotPasswordModel] Validating OTP for user: 28
[INFO] [2025-05-10 21:21:40] [OtpService] Validating OTP for user ID: 28, Code: 635741
[INFO] [2025-05-10 21:21:40] [OtpService] Using connection string: Data Source=ABAKAREKE_25497\SQLEXPRESS;Initial Catalog=ONLINE_LEARNING_PLATFORM;Integrated Security=True;TrustServerCertificate=True
[INFO] [2025-05-10 21:21:40] [OtpService] Opening database connection for validation
[INFO] [2025-05-10 21:21:40] [OtpService] Database connection opened successfully
[INFO] [2025-05-10 21:21:40] [OtpService] Verifying USER_OTPS table exists
[INFO] [2025-05-10 21:21:40] [OtpService] USER_OTPS table exists: True
[INFO] [2025-05-10 21:21:40] [OtpService] Found 5 OTP records for user ID: 28
[INFO] [2025-05-10 21:21:40] [OtpService] Executing validation SQL: SELECT COUNT(1) 
                      FROM USER_OTPS 
                      WHERE USER_ID = @UserId 
                      AND OTP_CODE = @OtpCode 
                      AND IS_VALID = 1 
                      AND EXPIRATION_TIME > GETDATE()
[INFO] [2025-05-10 21:21:40] [OtpService] Executing validation query
[INFO] [2025-05-10 21:21:41] [OtpService] Validation query returned: 1
[INFO] [2025-05-10 21:21:41] [OtpService] OTP validation successful for user ID: 28
[INFO] [2025-05-10 21:21:41] [ForgotPasswordModel] OTP validation result: True
[INFO] [2025-05-10 21:21:41] [ForgotPasswordModel] OTP validation successful
[INFO] [2025-05-10 21:21:41] [OtpService] Marking OTP as used for user ID: 28, Code: 635741
[INFO] [2025-05-10 21:21:41] [OtpService] Opening database connection
[INFO] [2025-05-10 21:21:41] [OtpService] Database connection opened successfully
[INFO] [2025-05-10 21:21:41] [OtpService] Marked 1 OTP records as used for user ID: 28
[INFO] [2025-05-10 21:21:56] [ForgotPasswordModel] Initializing ForgotPasswordModel
[INFO] [2025-05-10 21:21:56] [OtpService] Initialized with provided connection string
[INFO] [2025-05-10 21:21:56] [ForgotPasswordModel] Processing password reset
[INFO] [2025-05-10 21:21:56] [ForgotPasswordModel] Invalid model state for password reset
[INFO] [2025-05-10 21:34:45] [OtpService] Initialized with default connection string
[INFO] [2025-05-10 21:35:01] [ForgotPasswordModel] Initializing ForgotPasswordModel
[INFO] [2025-05-10 21:35:01] [OtpService] Initialized with provided connection string
[INFO] [2025-05-10 21:35:01] [ForgotPasswordModel] Loading forgot password page
[INFO] [2025-05-10 21:35:12] [OtpService] Initialized with default connection string
[INFO] [2025-05-10 21:35:24] [OtpService] Initialized with default connection string
[INFO] [2025-05-10 21:57:31] [OtpService] Initialized with default connection string
[INFO] [2025-05-10 21:57:38] [OtpService] Initialized with default connection string
[INFO] [2025-05-10 21:57:48] [OtpService] Initialized with default connection string
[INFO] [2025-05-10 21:57:59] [OtpService] Initialized with default connection string
[INFO] [2025-05-10 23:01:11] [OtpService] Initialized with default connection string
[INFO] [2025-05-10 23:01:21] [OtpService] Initialized with default connection string
[INFO] [2025-05-10 23:01:40] [OtpService] Initialized with default connection string
[INFO] [2025-05-10 23:02:05] [OtpService] Initialized with default connection string
[INFO] [2025-05-10 23:27:48] [OtpService] Initialized with default connection string
[INFO] [2025-05-10 23:28:04] [OtpService] Initialized with default connection string
[INFO] [2025-05-10 23:44:03] [OtpService] Initialized with default connection string
[INFO] [2025-05-10 23:44:14] [OtpService] Initialized with default connection string
[INFO] [2025-05-10 23:44:20] [OtpService] Initialized with default connection string
